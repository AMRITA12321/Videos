<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‚Äî Single File App (Firebase Hosting Ready)</title>
  <meta name="description" content="‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ ‚Äî Firebase Hosting Ready, Admin Control, Ads, Premium News ‡¶∏‡¶π‡•§" />
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
  <style>
    :root{
      --bg:#0b1220;--card:#0f172a;--muted:#94a3b8;--text:#e2e8f0;--brand:#0ea5e9;--accent:#22c55e;--danger:#ef4444;--warning:#f59e0b;
      --radius:16px;--shadow:0 10px 30px rgba(0,0,0,.25)
    }
    *{box-sizing:border-box}html,body{height:100%}body{
      margin:0;background:linear-gradient(180deg,#0b1220,#0b1220 60%,#0a0f1c);color:var(--text);font:500 15px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    header.nav{position:sticky;top:0;z-index:1000;background:rgba(11,18,32,.8);backdrop-filter:saturate(140%) blur(12px);border-bottom:1px solid rgba(148,163,184,.12)}
    .nav .row{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 16px}
    .brand{display:flex;gap:8px;align-items:center;font-weight:800}
    .brand .logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,var(--brand),#38bdf8 60%,#a78bfa);box-shadow:var(--shadow)}
    .nav .search{flex:1;max-width:520px;display:flex;border:1px solid rgba(148,163,184,.2);border-radius:999px;overflow:hidden}
    .nav input[type=search]{flex:1;padding:10px 14px;background:#0a1326;color:var(--text);border:0;outline:0}
    .nav .search button{padding:10px 14px;background:var(--brand);border:0;color:white;cursor:pointer}
    .nav .links{display:flex;gap:10px;flex-wrap:wrap}
    .btn{padding:9px 14px;border-radius:999px;border:1px solid rgba(148,163,184,.2);background:#0a1326;color:var(--text);cursor:pointer}
    .btn.primary{background:var(--brand);border-color:transparent;color:white}
    .btn.ghost{background:transparent}
    .btn.danger{background:var(--danger);border-color:transparent}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#0c1935;border:1px solid rgba(148,163,184,.18);color:#bfdbfe;font-size:12px}
    main{padding:18px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
    .col-12{grid-column:span 12}
    .col-9{grid-column:span 9}.col-8{grid-column:span 8}.col-6{grid-column:span 6}
    .col-4{grid-column:span 4}.col-3{grid-column:span 3}
    @media(max-width:980px){.col-9,.col-8{grid-column:span 12}.col-6{grid-column:span 12}.col-4{grid-column:span 6}.col-3{grid-column:span 6}}
    @media(max-width:600px){.col-4{grid-column:span 12}.col-3{grid-column:span 12}}
    .card{background:var(--card);border:1px solid rgba(148,163,184,.12);border-radius:var(--radius);box-shadow:var(--shadow)}
    .card.pad{padding:16px}
    .thumb{position:relative;border-radius:14px;overflow:hidden;background:#071126;border:1px solid rgba(148,163,184,.12)}
    .thumb img,.thumb iframe,.thumb video{width:100%;height:100%;display:block;object-fit:cover}
    .thumb .badge{position:absolute;right:8px;bottom:8px;background:rgba(0,0,0,.6);color:#fff;padding:4px 8px;border-radius:8px;font-weight:700;font-size:12px}
    .v-item{display:flex;gap:12px}
    .v-meta{display:flex;flex-direction:column;gap:6px}
    .muted{color:var(--muted)}
    .pill{display:inline-flex;align-items:center;border:1px solid rgba(148,163,184,.18);border-radius:999px;padding:4px 10px;font-size:12px;background:#0b1a31}
    .stack{display:flex;gap:10px;flex-wrap:wrap}
    .sep{height:1px;background:rgba(148,163,184,.12);margin:12px 0}
    .ad{background:linear-gradient(135deg,#0c1935,#0b213f);border:1px dashed rgba(148,163,184,.35);border-radius:14px;padding:14px;text-align:center}
    .table{width:100%;border-collapse:collapse;font-size:14px}
    .table th,.table td{padding:10px;border-bottom:1px solid rgba(148,163,184,.12);text-align:left}
    .notice{padding:12px;border:1px solid rgba(148,163,184,.2);border-radius:12px;background:#0b1a31}
    .label{font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type=text],input[type=url],input[type=email],input[type=password],select,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(148,163,184,.25);background:#0a1326;color:var(--text);outline:none}
    textarea{min-height:110px;resize:vertical}
    .player{aspect-ratio:16/9;border-radius:14px;overflow:hidden;border:1px solid rgba(148,163,184,.15);background:#000}
    .inline{display:inline-flex;gap:8px;align-items:center}
    footer{padding:30px 16px;color:var(--muted);text-align:center}
    .tag{font-size:12px;background:#08203c;border:1px solid rgba(148,163,184,.2);padding:4px 8px;border-radius:999px}
    .hidden{display:none!important}
  </style>

  <!-- Firebase SDKs (compat for quick start) -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.4/firebase-analytics-compat.js"></script>
</head>
<body>
  <header class="nav">
    <div class="row container">
      <a class="brand" href="#/home" aria-label="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶π‡ßã‡¶Æ">
        <span class="logo"></span><span>‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∂‡ßá‡ßü‡¶æ‡¶∞</span>
        <span class="chip" id="roleChip">role: viewer</span>
        <span class="chip" id="premiumChip">non-premium</span>
      </a>
      <form class="search" id="searchForm" role="search" aria-label="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®">
        <input id="q" type="search" placeholder="‡¶∏‡¶æ‡¶∞‡ßç‡¶ö: ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ, ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó, ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡ßá‡¶ó‡¶∞‡¶ø‚Ä¶" />
        <button type="submit">‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</button>
      </form>
      <nav class="links">
        <a class="btn ghost" href="#/home">‡¶π‡ßã‡¶Æ</a>
        <a class="btn ghost" href="#/upload">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</a>
        <a class="btn ghost" href="#/premium">‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶®‡¶ø‡¶â‡¶ú</a>
        <a class="btn ghost" href="#/profile">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</a>
        <a class="btn ghost" href="#/admin">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</a>
        <button class="btn primary" id="authBtn">‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶®</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <div id="view"></div>
  </main>

  <footer>
    ¬© <span id="year"></span> ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‚Ä¢ Firebase Hosting Ready ‚Ä¢ Infinix API hooks
  </footer>

<script>
/* ============================================================
   üîß Quick Setup (Change These Before Deploy)
=============================================================== */
const firebaseConfig = {
  apiKey: "AIzaSyBIwk_zUPiVrMtPGSh7AVTjO_zgUCt2dp8",
  authDomain: "videos-37e8f.firebaseapp.com",
  projectId: "videos-37e8f",
  appId: "1:518714664903:web:691c37e0e9978607cadbe2",
  measurementId: "G-FDY9ZRJZFD"
};
const API_BASE = ""; // backend ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶ì

/* ============================================================
   üß† Simple State (Local Mock) ‚Äî replace with real APIs later
=============================================================== */
const State = {
  user: null,          // {uid, email, displayName, role, premium}
  videos: [],          // array of {id,title,desc,src,type,tags,channel,approved,views,createdAt}
  comments: {},        // {videoId: [{user,text,at}]}
  adsEnabled: true,    // disable if premium
};
const ROLES = ["viewer", "creator", "moderator", "admin"];

/* ============================================================
   üöÄ Bootstrap
=============================================================== */
document.getElementById('year').textContent = new Date().getFullYear();
const App = {
  init(){
    try{
      firebase.initializeApp(firebaseConfig);
      if (firebase.analytics) firebase.analytics();
    }catch(e){console.warn("Firebase init skipped (use your keys)", e)}
    this.load();
    this.route();
    window.addEventListener('hashchange', ()=>this.route());
    document.getElementById('searchForm').addEventListener('submit', onSearch);
    document.getElementById('authBtn').addEventListener('click', toggleAuth);
    updateChips();
  },
  load(){
    const local = JSON.parse(localStorage.getItem('vs_data')||'{}');
    State.videos = local.videos || seedVideos();
    State.comments = local.comments || {};
    State.user = local.user || null;
    State.adsEnabled = !(State.user && State.user.premium);
    persist();
  },
  route(){
    const hash = location.hash || '#/home';
    const [_, route, param] = hash.split('/');
    const view = document.getElementById('view');
    if(route==='watch'){return renderWatch(view, param)}
    if(route==='upload'){return renderUpload(view)}
    if(route==='profile'){return renderProfile(view)}
    if(route==='admin'){return renderAdmin(view)}
    if(route==='premium'){return renderPremium(view)}
    return renderHome(view);
  }
};
window.addEventListener('load', ()=>App.init());

function persist(){
  localStorage.setItem('vs_data', JSON.stringify({
    user: State.user, videos: State.videos, comments: State.comments
  }));
}

/* ============================================================
   üîç Search
=============================================================== */
function onSearch(e){
  e.preventDefault();
  const q = document.getElementById('q').value.trim().toLowerCase();
  const results = State.videos.filter(v =>
    (v.title||'').toLowerCase().includes(q) ||
    (v.tags||[]).join(',').toLowerCase().includes(q)
  );
  renderHome(document.getElementById('view'), results, q);
}

/* ============================================================
   üë§ Auth (Mock) + Role/Premium Toggle
=============================================================== */
function toggleAuth(){
  if(State.user){
    State.user=null;
    State.adsEnabled=true;
    persist(); updateChips();
    App.route(); return;
  }
  const name=prompt("‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶°‡ßá‡¶Æ‡ßã):","Amrita");
  const role=prompt("‡¶∞‡ßã‡¶≤ (viewer/creator/moderator/admin):","creator");
  const premium=confirm("Premium ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶¨‡ßá‡¶®? OK=Yes");
  State.user={uid:"local-"+Date.now(),displayName:name||"Guest",email:"guest@example.com",role:ROLES.includes(role)?role:"viewer",premium};
  State.adsEnabled=!premium;
  persist(); updateChips(); App.route();
}
function requireRole(roles){
  if(!State.user || !roles.includes(State.user.role)){
    alert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶°‡¶ø‡¶®‡¶æ‡¶á‡¶°‡•§ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü ‡¶∞‡ßã‡¶≤: "+roles.join(', '));
    location.hash="#/home"; return false;
  }
  return true;
}
function updateChips(){
  const roleChip=document.getElementById('roleChip');
  const premiumChip=document.getElementById('premiumChip');
  roleChip.textContent="role: "+(State.user? State.user.role : "viewer");
  premiumChip.textContent= (State.user&&State.user.premium) ? "premium" : "non-premium";
  document.getElementById('authBtn').textContent = State.user? "‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶â‡¶ü" : "‡¶∏‡¶æ‡¶á‡¶® ‡¶á‡¶®";
}

/* ============================================================
   üè† Home
=============================================================== */
function renderHome(el, list=null, q=null){
  const items = (list || State.videos).filter(v=>v.approved);
  const header = `
    <div class="stack">
      <span class="pill">‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç</span>
      <span class="pill">‡¶®‡¶§‡ßÅ‡¶®</span>
      <span class="pill">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</span>
      ${q? `<span class="pill">‡¶∏‡¶æ‡¶∞‡ßç‡¶ö: ‚Äú${escapeHTML(q)}‚Äù</span>`:''}
    </div>
    <div class="sep"></div>
  `;
  const grid = items.map(v=>videoCard(v)).join('');
  const adBlock = (!State.user||!State.user.premium) ? `<div class="ad">Ad Slot ‚Ä¢ CPM ‚Ä¢ CTR</div>` : '';
  el.innerHTML = `
    ${adBlock}
    <div class="grid">
      ${grid || `<div class="col-12"><div class="notice">‡¶ï‡ßã‡¶® ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶®‡ßá‡¶á‡•§ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div></div>`}
    </div>
  `;
  el.insertAdjacentHTML('afterbegin', header);
}
function videoCard(v){
  return `
  <div class="col-4">
    <div class="card pad">
      <a class="thumb" href="#/watch/${v.id}" aria-label="${escapeHTML(v.title)}">
        ${thumbEmbed(v)}
        <span class="badge">‚ñ∂ ${nfmt(v.views)}</span>
      </a>
      <div class="v-item" style="margin-top:10px">
        <div style="width:46px;height:46px;border-radius:50%;background:#0a1326;border:1px solid rgba(148,163,184,.2)"></div>
        <div class="v-meta">
          <a class="inline" href="#/watch/${v.id}" style="font-weight:700">${escapeHTML(v.title)}</a>
          <div class="muted">${escapeHTML(v.channel)} ‚Ä¢ ${timeago(v.createdAt)}</div>
          <div class="stack">${(v.tags||[]).slice(0,3).map(t=>`<span class="tag">#${escapeHTML(t)}</span>`).join('')}</div>
        </div>
      </div>
    </div>
  </div>`;
}
function thumbEmbed(v){
  if(v.type==='youtube'){
    const id = ytId(v.src);
    return `<img alt="" src="https://i.ytimg.com/vi/${id}/hqdefault.jpg" loading="lazy">`;
  }
  if(v.type==='vimeo'){
    return `<img alt="" src="https://vumbnail.com/${v.vimeoId||'000'}.jpg" loading="lazy">`;
  }
  return `<img alt="" src="https://picsum.photos/seed/${encodeURIComponent(v.id)}/800/450" loading="lazy">`;
}

/* ============================================================
   üé• Watch Page
=============================================================== */
function renderWatch(el, id){
  const v = State.videos.find(x=>x.id===id);
  if(!v){el.innerHTML=`<div class="notice">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</div>`;return}
  v.views++; persist();

  el.innerHTML = `
    <div class="grid">
      <div class="col-9">
        <div class="player">${playerEmbed(v)}</div>
        <div class="stack" style="margin-top:12px">
          <h2 style="margin:0">${escapeHTML(v.title)}</h2>
          ${(!State.user||!State.user.premium) ? `<span class="chip">Ad ‚Ä¢ mid-roll</span>`:''}
        </div>
        <div class="muted">${escapeHTML(v.channel)} ‚Ä¢ ${nfmt(v.views)} ‡¶≠‡¶ø‡¶â ‚Ä¢ ${timeago(v.createdAt)}</div>
        <div class="sep"></div>
        <p>${escapeHTML(v.desc||'')}</p>
        <div class="stack">${(v.tags||[]).map(t=>`<span class="tag">#${escapeHTML(t)}</span>`).join('')}</div>
        <div class="sep"></div>
        <div>
          <div class="label">‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
          <form id="cform" class="stack">
            <input type="text" id="ctext" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø‚Ä¶" />
            <button class="btn primary" type="submit">‡¶™‡ßã‡¶∏‡ßç‡¶ü</button>
          </form>
          <div id="clist" style="margin-top:10px"></div>
        </div>
      </div>
      <div class="col-3">
        ${(!State.user||!State.user.premium) ? `<div class="ad">Sidebar Ad</div>`:''}
        <div class="sep"></div>
        <div class="card pad"><div class="label">‡¶∞‡¶ø‡¶≤‡ßá‡¶ü‡ßá‡¶°</div>${related(v.id)}</div>
      </div>
    </div>
  `;
  const cf=document.getElementById('cform');
  cf.addEventListener('submit',e=>{
    e.preventDefault();
    if(!State.user){alert("‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶æ‡¶á‡¶®-‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®");return}
    const t=document.getElementById('ctext').value.trim();
    if(!t) return;
    (State.comments[v.id] = State.comments[v.id] || []).push({user: State.user.displayName, text:t, at: Date.now()});
    persist();
    document.getElementById('ctext').value='';
    renderComments(v.id);
  });
  renderComments(v.id);
}
function playerEmbed(v){
  if(v.type==='youtube'){return `<iframe src="https://www.youtube.com/embed/${ytId(v.src)}" title="YouTube video" frameborder="0" allowfullscreen></iframe>`}
  if(v.type==='vimeo'){return `<iframe src="https://player.vimeo.com/video/${v.vimeoId||'76979871'}" title="Vimeo video" frameborder="0" allowfullscreen></iframe>`}
  if(/\.(mp4|webm|m3u8)$/i.test(v.src)){
    return `<video src="${escapeAttr(v.src)}" controls playsinline></video>`;
  }
  return `<div class="notice">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶° ‡¶®‡ßü ‡¶è‡¶Æ‡¶® ‡¶∏‡ßã‡¶∞‡ßç‡¶∏‡•§</div>`;
}
function related(exceptId){
  return State.videos.filter(v=>v.approved && v.id!==exceptId).slice(0,6).map(v=>`
    <div style="display:flex;gap:10px;margin:8px 0">
      <a class="thumb" style="width:120px;height:70px" href="#/watch/${v.id}">${thumbEmbed(v)}</a>
      <div style="flex:1">
        <a href="#/watch/${v.id}" style="font-weight:700">${escapeHTML(v.title)}</a>
        <div class="muted">${escapeHTML(v.channel)}</div>
      </div>
    </div>
  `).join('');
}
function renderComments(id){
  const wrap=document.getElementById('clist');
  const list=(State.comments[id]||[]).slice().reverse();
  wrap.innerHTML=list.map(c=>`
    <div class="card pad" style="margin:8px 0">
      <div class="inline"><strong>${escapeHTML(c.user)}</strong><span class="muted">${timeago(c.at)}</span></div>
      <div>${escapeHTML(c.text)}</div>
    </div>
  `).join('') || `<div class="muted">‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‚Ä¶</div>`;
}

/* ============================================================
   ‚¨ÜÔ∏è Upload (File/Link)
=============================================================== */
function renderUpload(el){
  if(!State.user){el.innerHTML=`<div class="notice">‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶æ‡¶á‡¶®-‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>`;return}
  if(!requireRole(["creator","moderator","admin"])) return;

  el.innerHTML=`
    <div class="grid">
      <div class="col-8">
        <div class="card pad">
          <h2 style="margin-top:0">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</h2>
          <div class="sep"></div>
          <form id="uform" class="grid">
            <div class="col-6">
              <div class="label">‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</div>
              <input type="text" name="title" required placeholder="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
            </div>
            <div class="col-6">
              <div class="label">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡ßá‡¶ó‡¶∞‡¶ø</div>
              <input type="text" name="category" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: Tech">
            </div>
            <div class="col-12">
              <div class="label">‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ</div>
              <textarea name="desc" placeholder="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ"></textarea>
            </div>
            <div class="col-12">
              <div class="label">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡¶ø‡¶Ç‡¶ï (YouTube/Vimeo/MP4/M3U8)</div>
              <input type="url" name="src" required placeholder="https://youtu.be/xyz ‡¶¨‡¶æ https://cdn.com/video.mp4">
            </div>
            <div class="col-12">
              <div class="label">‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó (‡¶ï‡¶Æ‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ)</div>
              <input type="text" name="tags" placeholder="news,tech,funny">
            </div>
            <div class="col-12">
              <button class="btn primary" type="submit">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü (‡¶∞‡¶ø‡¶≠‡¶ø‡¶â‡¶§‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá)</button>
            </div>
          </form>
        </div>
      </div>
      <div class="col-4">
        <div class="card pad">
          <div class="label">‡¶ó‡¶æ‡¶á‡¶°</div>
          <ul style="margin:0 0 0 16px">
            <li>‡¶ï‡¶™‡¶ø‡¶∞‡¶æ‡¶á‡¶ü‡ßá‡¶° ‡¶ï‡¶®‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ</li>
            <li>‡¶π‡¶ø‡¶Ç‡¶∏‡¶æ/‡¶¨‡¶ø‡¶¶‡ßç‡¶¨‡ßá‡¶∑/‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø ‚Äî ‡¶®‡¶ø‡¶∑‡¶ø‡¶¶‡ßç‡¶ß</li>
            <li>YouTube/Vimeo ‡¶¶‡¶ø‡¶≤‡ßá ‡¶•‡¶æ‡¶Æ‡ßç‡¶¨ ‡¶Ö‡¶ü‡ßã ‡¶´‡ßá‡¶ö ‡¶π‡¶¨‡ßá</li>
          </ul>
        </div>
      </div>
    </div>
  `;
  document.getElementById('uform').addEventListener('submit', e=>{
    e.preventDefault();
    const fd=new FormData(e.target);
    const title=fd.get('title').trim();
    const src=fd.get('src').trim();
    const desc=fd.get('desc').trim();
    const tags=(fd.get('tags')||'').split(',').map(s=>s.trim()).filter(Boolean);
    const v = buildVideoFromSource({title, src, desc, tags, channel: State.user.displayName || "Creator"});
    State.videos.push(v); persist();
    alert("‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü‡ßá‡¶°! ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶®‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶π‡¶¨‡ßá‡•§");
    location.hash=`#/watch/${v.id}`;
  });
}
function buildVideoFromSource({title,src,desc,tags,channel}){
  let type="file", yt=null, vimeo=null;
  if(/youtu\.?be/.test(src)){
    type="youtube"; yt=ytId(src);
  }else if(/vimeo/.test(src)){
    type="vimeo"; vimeo = (src.split("/").pop()||"").split("?")[0];
  }else if(/\.(mp4|webm|m3u8)$/i.test(src)){
    type="file";
  }
  return {
    id: "v"+Date.now(),
    title: title || "Untitled",
    desc: desc || "",
    src,
    type,
    vimeoId: vimeo,
    tags,
    channel,
    approved:false,
    views:0,
    createdAt: Date.now()
  };
}

/* ============================================================
   üë®‚Äç‚úàÔ∏è Admin
=============================================================== */
function renderAdmin(el){
  if(!requireRole(["admin","moderator"])) return;
  const pending = State.videos.filter(v=>!v.approved);
  const all = State.videos.slice().reverse();
  el.innerHTML = `
    <div class="grid">
      <div class="col-8">
        <div class="card pad">
          <h2 style="margin:0">‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶ï‡¶ø‡¶â</h2>
          <div class="sep"></div>
          ${pending.map(v=>`
            <div class="v-item" style="justify-content:space-between">
              <div class="inline" style="gap:12px">
                <div class="thumb" style="width:120px;height:70px">${thumbEmbed(v)}</div>
                <div>
                  <div style="font-weight:700">${escapeHTML(v.title)}</div>
                  <div class="muted">${escapeHTML(v.channel)} ‚Ä¢ ${timeago(v.createdAt)}</div>
                </div>
              </div>
              <div class="inline">
                <button class="btn" onclick="approveVideo('${v.id}',true)">Approve</button>
                <button class="btn danger" onclick="deleteVideo('${v.id}')">Delete</button>
              </div>
            </div>
            <div class="sep"></div>
          `).join('') || `<div class="notice">‡¶ï‡ßã‡¶® ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶®‡ßá‡¶á‡•§</div>`}
        </div>
      </div>
      <div class="col-4">
        <div class="card pad">
          <h3 style="margin:0 0 10px 0">‡¶∏‡¶¨ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì</h3>
          <div style="max-height:460px;overflow:auto">
            <table class="table">
              <thead><tr><th>‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</th><th>‡¶≠‡¶ø‡¶â</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th></tr></thead>
              <tbody>
                ${all.map(v=>`<tr>
                  <td><a href="#/watch/${v.id}">${escapeHTML(v.title)}</a></td>
                  <td>${nfmt(v.views)}</td>
                  <td>${v.approved? 'Live':'Pending'}</td>
                </tr>`).join('')}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
}
function approveVideo(id,flag){
  const v=State.videos.find(x=>x.id===id); if(!v) return;
  v.approved=!!flag; persist(); App.route();
}
function deleteVideo(id){
  if(!confirm("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return;
  State.videos = State.videos.filter(v=>v.id!==id);
  delete State.comments[id];
  persist(); App.route();
}

/* ============================================================
   üë§ Profile
=============================================================== */
function renderProfile(el){
  if(!State.user){el.innerHTML=`<div class="notice">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶∏‡¶æ‡¶á‡¶®-‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>`;return}
  el.innerHTML = `
    <div class="card pad">
      <h2 style="margin:0 0 10px 0">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2>
      <div class="grid">
        <div class="col-6">
          <div class="label">‡¶®‡¶æ‡¶Æ</div>
          <input value="${escapeAttr(State.user.displayName||'')}" id="pname">
        </div>
        <div class="col-6">
          <div class="label">‡¶∞‡ßã‡¶≤</div>
          <select id="prole">
            ${ROLES.map(r=>`<option value="${r}" ${State.user.role===r?'selected':''}>${r}</option>`).join('')}
          </select>
        </div>
        <div class="col-12">
          <label class="inline"><input type="checkbox" id="ppremium" ${State.user.premium?'checked':''} style="accent-color:#0ea5e9"> Premium</label>
        </div>
        <div class="col-12">
          <button class="btn primary" onclick="saveProfile()">‡¶∏‡ßá‡¶≠</button>
        </div>
      </div>
    </div>
  `;
}
function saveProfile(){
  State.user.displayName = document.getElementById('pname').value.trim()||State.user.displayName;
  State.user.role = document.getElementById('prole').value;
  State.user.premium = document.getElementById('ppremium').checked;
  State.adsEnabled = !State.user.premium;
  persist(); updateChips(); alert("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); App.route();
}

/* ============================================================
   ‚≠ê Premium (demo)
=============================================================== */
function renderPremium(el){
  const news=[
    {t:"‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡ßü‡¶æ‡¶Æ ‡¶®‡¶ø‡¶â‡¶ú ‡ßß", d:"‡¶è‡¶ü‡¶æ ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶á ‡¶°‡ßá‡¶Æ‡ßã ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü‡•§"},
    {t:"‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡ßü‡¶æ‡¶Æ ‡¶®‡¶ø‡¶â‡¶ú ‡ß®", d:"‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ó‡¶≤‡ßç‡¶™‡•§"}
  ];
  if(!State.user || !State.user.premium){
    el.innerHTML=`<div class="notice">‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡ßü‡¶æ‡¶Æ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶§‡ßá Premium ‡¶®‡¶ø‡¶® (Profile ‡¶•‡ßá‡¶ï‡ßá On ‡¶ï‡¶∞‡ßÅ‡¶®)‡•§</div>`;
    return;
  }
  el.innerHTML = `
    <div class="grid">
      ${news.map(n=>`<div class="col-6"><div class="card pad"><h3 style="margin:0">${escapeHTML(n.t)}</h3><p>${escapeHTML(n.d)}</p></div></div>`).join('')}
    </div>
  `;
}

/* ============================================================
   üß∞ Utils
=============================================================== */
function ytId(url){
  try{
    const m = url.match(/(?:youtu\.be\/|v=|embed\/)([A-Za-z0-9_-]{6,})/);
    return m? m[1] : "";
  }catch{ return "" }
}
function timeago(ts){
  const s = Math.floor((Date.now()-ts)/1000);
  const units=[['‡¶¨‡¶õ‡¶∞',31536000],['‡¶Æ‡¶æ‡¶∏',2592000],['‡¶¶‡¶ø‡¶®',86400],['‡¶ò‡¶£‡ßç‡¶ü‡¶æ',3600],['‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü',60],['‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°',1]];
  for(const [u,v] of units){ if(s>=v) return `${Math.floor(s/v)} ${u} ‡¶Ü‡¶ó‡ßá`; }
  return "‡¶è‡¶á‡¶Æ‡¶æ‡¶§‡ßç‡¶∞";
}
function nfmt(n){ return new Intl.NumberFormat('bn-BD').format(n||0); }
function escapeHTML(str){ return (str||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function escapeAttr(str){ return escapeHTML(str).replace(/"/g,'&quot;'); }
function seedVideos(){
  const now=Date.now();
  return [
    {
      id:"vseed1",
      title:"Firebase Hosting ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶á‡¶ü ‡¶≤‡¶æ‡¶á‡¶≠",
      desc:"‡¶ü‡¶æ‡¶∞‡ßç‡¶Æ‡¶æ‡¶ï‡ßç‡¶∏‡ßá ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶°‡¶ø‡¶™‡ßç‡¶≤‡¶Ø‡¶º ‡¶°‡ßá‡¶Æ‡ßã‡•§",
      src:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",
      type:"youtube",
      tags:["firebase","hosting","deploy"],
      channel:"Dev BD",
      approved:true,
      views:3250,
      createdAt: now-86400*1000
    },
    {
      id:"vseed2",
      title:"Funny Cats Compilation",
      desc:"‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶π‡¶æ‡¶∏‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø üò∏",
      src:"https://cdn.example.com/cats.mp4",
      type:"file",
      tags:["funny","cats"],
      channel:"Cats TV",
      approved:true,
      views:12900,
      createdAt: now-3600*1000
    }
  ];
}
</script>
</body>
</html>